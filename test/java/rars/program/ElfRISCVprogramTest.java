package test.java.rars.program;

import java.util.ArrayList;

import org.junit.Assert;
import org.junit.Test;

import rars.AssemblyException;
import rars.program.ElfRISCVprogram;
import rars.program.RISCVprogram;

public class ElfRISCVprogramTest {
	
	@Test
	public void readSourceTest() {
		String[] correct = {
				"Address   Raw Data                                         Char Data",
				"00000000  7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00  .ELF............",
				"00000010  01 00 f3 00 01 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000020  00 00 00 00 00 00 00 00 48 01 00 00 00 00 00 00  ........H.......",
				"00000030  04 00 00 00 40 00 00 00 00 00 40 00 08 00 07 00  ....@.....@.....",
				"00000040  93 02 c0 03 13 03 00 00 13 03 53 00 93 82 f2 ff  ..........S.....",
				"00000050  e3 1c 53 fe 00 00 00 00 00 00 00 00 00 00 00 00  ..S.............",
				"00000060  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000070  00 00 00 00 03 00 01 00 00 00 00 00 00 00 00 00  ................",
				"00000080  00 00 00 00 00 00 00 00 00 00 00 00 03 00 03 00  ................",
				"00000090  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"000000a0  00 00 00 00 03 00 04 00 00 00 00 00 00 00 00 00  ................",
				"000000b0  00 00 00 00 00 00 00 00 01 00 00 00 00 00 01 00  ................",
				"000000c0  08 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"000000d0  06 00 00 00 10 00 01 00 00 00 00 00 00 00 00 00  ................",
				"000000e0  00 00 00 00 00 00 00 00 00 6c 6f 6f 70 00 6d 61  .........loop.ma",
				"000000f0  69 6e 00 00 00 00 00 00 10 00 00 00 00 00 00 00  in..............",
				"00000100  10 00 00 00 04 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000110  00 2e 73 79 6d 74 61 62 00 2e 73 74 72 74 61 62  ..symtab..strtab",
				"00000120  00 2e 73 68 73 74 72 74 61 62 00 2e 72 65 6c 61  ..shstrtab..rela",
				"00000130  2e 74 65 78 74 00 2e 64 61 74 61 00 2e 62 73 73  .text..data..bss",
				"00000140  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000150  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000160  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000170  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000180  00 00 00 00 00 00 00 00 20 00 00 00 01 00 00 00  ........ .......",
				"00000190  06 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"000001a0  40 00 00 00 00 00 00 00 14 00 00 00 00 00 00 00  @...............",
				"000001b0  00 00 00 00 00 00 00 00 04 00 00 00 00 00 00 00  ................",
				"000001c0  00 00 00 00 00 00 00 00 1b 00 00 00 04 00 00 00  ................",
				"000001d0  40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  @...............",
				"000001e0  f8 00 00 00 00 00 00 00 18 00 00 00 00 00 00 00  ................",
				"000001f0  05 00 00 00 01 00 00 00 08 00 00 00 00 00 00 00  ................",
				"00000200  18 00 00 00 00 00 00 00 26 00 00 00 01 00 00 00  ........&.......",
				"00000210  03 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000220  54 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  T...............",
				"00000230  00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00  ................",
				"00000240  00 00 00 00 00 00 00 00 2c 00 00 00 08 00 00 00  ........,.......",
				"00000250  03 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000260  54 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  T...............",
				"00000270  00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00  ................",
				"00000280  00 00 00 00 00 00 00 00 01 00 00 00 02 00 00 00  ................",
				"00000290  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"000002a0  58 00 00 00 00 00 00 00 90 00 00 00 00 00 00 00  X...............",
				"000002b0  06 00 00 00 05 00 00 00 08 00 00 00 00 00 00 00  ................",
				"000002c0  18 00 00 00 00 00 00 00 09 00 00 00 03 00 00 00  ................",
				"000002d0  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"000002e0  e8 00 00 00 00 00 00 00 0b 00 00 00 00 00 00 00  ................",
				"000002f0  00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00  ................",
				"00000300  00 00 00 00 00 00 00 00 11 00 00 00 03 00 00 00  ................",
				"00000310  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................",
				"00000320  10 01 00 00 00 00 00 00 31 00 00 00 00 00 00 00  ........1.......",
				"00000330  00 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00  ................",
				"00000340  00 00 00 00 00 00 00 00                          ........",		
		};
		
		RISCVprogram p = new ElfRISCVprogram();
		
		try {
			p.readSource(ElfRISCVprogramTest.class.getResource("ElfRISCVprogramTest.elf").getPath());
		}
		catch(AssemblyException e) {
			System.err.println(e.errors().generateErrorAndWarningReport());
			e.printStackTrace();
			Assert.assertTrue(false);
		}
		
		ArrayList<String> file = p.getSourceList();
		
		Assert.assertEquals(file.size(), correct.length);
		
		for(int i = 0; i < file.size(); i++) {
			Assert.assertEquals(correct[i].length(), file.get(i).length());
			Assert.assertEquals(correct[i], file.get(i));
			System.out.println(file.get(i));
		}
	}
}
